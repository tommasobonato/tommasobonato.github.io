!function(){function t(){const t=x("#tb-rocketbar");if(!t)return;const e=x(".tb-track",t),n=x(".tb-rocket",t),a=()=>{const a=document.documentElement,r=a.scrollTop||window.pageYOffset||0,o=Math.max(1,a.scrollHeight-a.clientHeight),s=Math.max(0,Math.min(1,r/o));e.style.transform=`scaleX(${s})`,n.style.transform=`translateX(calc(${(100*s).toFixed(3)}% - 8px))`,t.style.opacity=s>0?1:0};a(),addEventListener("scroll",(()=>requestAnimationFrame(a)),{passive:!0}),addEventListener("resize",(()=>requestAnimationFrame(a)))}function e(){const t=x("#tb-latency");if(!t)return;let e=0;try{const t=performance.getEntriesByType("navigation")[0];t&&t.loadEventEnd&&(e=Math.round(t.loadEventEnd))}catch(t){}e||(e=Math.round(performance.now()));const n=.1,a=8,r=40,o=t=>t>=100?Math.round(t):t>=10?t.toFixed(1):t.toFixed(2);t.innerHTML=`<button class="tb-close" aria-label="Close" title="Close">\xd7</button>\n      <div class="tb-line"><strong>${e} ms</strong> page load</div>\n      <div class="tb-line">\u2248 <b>${o(e/n)}</b>\xd7 DC east\u2013west RTT</div>\n      <div class="tb-line">\u2248 <b>${o(e/a)}</b>\xd7 ZH\u2013FRA RTT</div>\n      <div class="tb-line">\u2248 <b>${o(e/r)}</b>\xd7 LEO hop</div>`,requestAnimationFrame((()=>t.classList.add("show")));const s=parseInt(t.dataset.seconds||"10",10),i=setTimeout((()=>t.remove()),1e3*Math.max(0,s));x(".tb-close",t).addEventListener("click",(()=>{clearTimeout(i),t.remove()}))}function n(t){return{q:0,maxQ:L.maxQ,drops:0,dropAcc:0,randAcc:0,servicePps:$(t),tpMbps:0}}function a(t,e,n){const a=e*n,r=a*L.randDrop+t.randAcc,o=Math.floor(r);t.randAcc=r-o;const s=Math.max(0,a-o),i=t.q+s,c=Math.min(t.servicePps*n,i),l=i-c;let d=t.q+R*(l-t.q);const g=Math.max(0,d-t.maxQ),m=g+t.dropAcc,u=Math.floor(m);return t.dropAcc=m-u,g>0&&(d=t.maxQ),t.q=d,t.drops+=o+u,t.tpMbps=c/n*L.pktBits/1e6,c}function r(t,e){if(t&&!t.children.length)for(let n=0;n<e;n++){const e=document.createElement("span");e.className="tb-led",t.appendChild(e)}}function o(t,e,n){const a=h(".tb-led",n);for(let n=0;n<e;n++){const r=t>>e-1-n&1;a[n]?.classList.toggle("on",!!r)}}function s(t,e,n){const a=parseInt(t.getAttribute("data-bits")||"6",10);r(x(".tb-q",t),a),r(x(".tb-t",t),a),r(x(".tb-dr",t),a);const s=e.maxQ?C(Math.round(e.q/e.maxQ*100),0,100):0,i=Math.round(s*((1<<a)-1)/100),c=C(Math.round(e.tpMbps*((1<<a)-1)/n),0,(1<<a)-1),l=Math.min((1<<a)-1,e.drops&(1<<a)-1);o(i,a,x(".tb-q",t)),o(c,a,x(".tb-t",t)),o(l,a,x(".tb-dr",t)),x(".tb-q-bits",t).textContent=E(i,a),x(".tb-t-bits",t).textContent=E(c,a),x(".tb-dr-bits",t).textContent=E(l,a),x(".tb-q-dec",t).textContent=s,x(".tb-t-dec",t).textContent=e.tpMbps.toFixed(1),x(".tb-dr-dec",t).textContent=String(e.drops)}function i(){const t=x("#agg-rack"),e=x("#torL-rack"),n=x("#torR-rack");t&&s(t,A.agg,L.capAggMb),e&&s(e,A.torL,L.capTorMb),n&&s(n,A.torR,L.capTorMb)}function c(){const t=x("#sim-rate"),e=x("#sim-rate-val"),n=x("#sim-qmax"),a=x("#sim-qmax-val"),r=x("#sim-rdrop"),o=x("#sim-rdrop-val"),s=x("#sim-bp");t&&t.addEventListener("input",(t=>{L.sendRate=+t.target.value/100,e.textContent=`${Math.round(100*L.sendRate)}%`})),n&&n.addEventListener("input",(t=>{L.maxQ=parseInt(t.target.value,10),A.agg.maxQ=A.torL.maxQ=A.torR.maxQ=L.maxQ,a.textContent=String(L.maxQ)})),r&&(r.addEventListener("input",(t=>{const e=parseFloat(t.target.value);L.randDrop=e/100,o.textContent=`${e.toFixed(3)}%`})),L.randDrop=parseFloat(r.value)/100),s&&(y.enabled=s.checked||!1,s.addEventListener("change",(t=>{y.enabled=!!t.target.checked})))}function l(){const t=x("#agg-wrapper");if(!t)return;const e=t.closest("article"),n=e?e.querySelector(".profile.float-right, .profile.float-left, .profile"):null;if(t.style.width="100%",t.style.marginLeft="",t.style.marginRight="",e&&n){const a=e.getBoundingClientRect(),r=n.getBoundingClientRect(),o=Math.round(r.left-a.left-16);o>200&&(t.style.width=o+"px",t.style.marginLeft="0",t.style.marginRight="auto")}}function d(){const t=x("#agg-wrapper"),e=x("#agg-svg"),n=x("#torL-rack"),a=x("#torR-rack");if(!(t&&e&&n&&a))return;const r=t.getBoundingClientRect(),o=n.getBoundingClientRect(),s=a.getBoundingClientRect(),i=e.getBoundingClientRect(),c=r.width,l=i.height,d=c/2,g=8,m=o.left+o.width/2-r.left,u=s.left+s.width/2-r.left,f=l-4,p=(g+f)/2,h=`M ${d},${g} C ${d},${p} ${m},${p} ${m},${f}`,b=`M ${d},${g} C ${d},${p} ${u},${p} ${u},${f}`;e.setAttribute("viewBox",`0 0 ${Math.max(1,c)} ${Math.max(1,l)}`),k("agg-left",h),k("agg-right",b),F("agg-left",{x:d,y:g},{x:d,y:p},{x:m,y:p},{x:m,y:f}),F("agg-right",{x:d,y:g},{x:d,y:p},{x:u,y:p},{x:u,y:f})}function g(t,e,n){const a=x("#"+e),r=x("#"+t);if(!a||!r)return;const o=a.getBoundingClientRect(),s=o.width,i=o.height;a.setAttribute("viewBox",`0 0 ${Math.max(1,s)} ${Math.max(1,i)}`);const c=s/2,l=8,d=i-4,g=(l+d)/2;h(".leaf",r.parentElement).forEach(((t,e)=>{const a=t.getBoundingClientRect(),r=a.left+a.width/2-o.left;k(n+e,`M ${c},${l} C ${c},${g} ${r},${g} ${r},${d}`),F(n+e,{x:c,y:l},{x:c,y:g},{x:r,y:g},{x:r,y:d})}))}function m(){d(),g("torL-rack","torL-svg","leafL"),g("torR-rack","torR-svg","leafR")}function u(t,e,n,a,r){const o=1-r,s=r*r,i=o*o,c=i*o,l=s*r;return{x:c*t.x+3*i*r*e.x+3*o*s*n.x+l*a.x,y:c*t.y+3*i*r*e.y+3*o*s*n.y+l*a.y}}function f(){function t(t,e,n){if(!w[t]||i.length>=s||L.sendRate<=0)return;const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("class","pkt"),a.setAttribute("r","4"),e.appendChild(a),i.push({el:a,key:t,start:performance.now(),dur:3e3+2e3*Math.random(),dir:n?-1:1,svg:e})}function e(n,a,r){const o=1100,s=o-(o-120)*L.sendRate+120*Math.random();L.sendRate>0&&t(n,a,r),setTimeout((()=>e(n,a,r)),s)}function n(t){for(let e=i.length-1;e>=0;e--){const n=i[e],a=w[n.key];if(!a){n.el.remove(),i.splice(e,1);continue}const r=Math.min(1,Math.max(0,(t-n.start)/n.dur)),o=-1===n.dir?1-r:r,s=c(a,o);n.el.setAttribute("cx",s.x.toFixed(2)),n.el.setAttribute("cy",s.y.toFixed(2)),r>=1&&(n.el.remove(),i.splice(e,1))}requestAnimationFrame(n)}const a=x("#agg-svg"),r=x("#torL-svg"),o=x("#torR-svg");if(!a||!r||!o)return;const s=180,i=[];[["agg-left",a,!1],["agg-left",a,!0],["agg-right",a,!1],["agg-right",a,!0],["leafL0",r,!1],["leafL0",r,!0],["leafL1",r,!1],["leafL1",r,!0],["leafL2",r,!1],["leafL2",r,!0],["leafL3",r,!1],["leafL3",r,!0],["leafR0",o,!1],["leafR0",o,!0],["leafR1",o,!1],["leafR1",o,!0],["leafR2",o,!1],["leafR2",o,!0],["leafR3",o,!1],["leafR3",o,!0]].forEach((t=>e(...t)));const c=(t,e)=>u(t.p0,t.p1,t.p2,t.p3,e);requestAnimationFrame(n),addEventListener("resize",(()=>{i.forEach((t=>t.el.remove())),i.length=0}),{passive:!0})}function p(){function t(){const n=performance.now(),r=Math.max(.001,(n-e)/1e3);e=n;const o=v*L.sendRate,s=b*o*(1-M),c=q(A.torL.maxQ?A.torL.q/A.torL.maxQ:0),l=q(A.torR.maxQ?A.torR.q/A.torR.maxQ:0),d=$(s*c),g=$(s*l),m=a(A.torL,d,r)/r,u=a(A.torR,g,r)/r;a(A.agg,m+u,r),i(),requestAnimationFrame(t)}let e=performance.now();requestAnimationFrame(t)}const x=(t,e=document)=>e.querySelector(t),h=(t,e=document)=>Array.from(e.querySelectorAll(t)),b=4,v=100,M=.1,R=.02,y={enabled:!1,start:.7,end:1},L={sendRate:.5,pktBits:8e3,capTorMb:200,capAggMb:400,maxQ:400,randDrop:1e-5},$=t=>1e6*t/L.pktBits,A={agg:n(L.capAggMb),torL:n(L.capTorMb),torR:n(L.capTorMb)},C=(t,e,n)=>Math.max(e,Math.min(n,t)),q=t=>y.enabled?t<=y.start?1:t>=y.end?0:1-(t-y.start)/(y.end-y.start):1,E=(t,e)=>(t>>>0).toString(2).padStart(e,"0"),w={},k=(t,e)=>{const n=x(t.startsWith("#")?t:"#"+t);n&&n.setAttribute("d",e)},F=(t,e,n,a,r)=>{w[t]={p0:e,p1:n,p2:a,p3:r}};document.addEventListener("DOMContentLoaded",(()=>{t(),e(),c(),l(),m(),setTimeout((()=>{m(),f(),p()}),150)})),addEventListener("load",(()=>{l(),m()}),{once:!0}),addEventListener("resize",(()=>{l(),m()}),{passive:!0})}();